{% extends 'base.html' %}

{% block extra_head %}
<style>
    .similarity-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 4px 8px;
        color: white;
        font-weight: bold;
        border-radius: 4px;
    }
    
    .similarity-high {
        background-color: #10B981;
    }
    
    .similarity-medium {
        background-color: #3B82F6;
    }
    
    .similarity-low {
        background-color: #F59E0B;
    }
    
    .similarity-very-low {
        background-color: #EF4444;
    }
    
    .image-card {
        transition: all 0.3s ease;
    }
    
    .image-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
</style>
{% endblock %}

{% block content %}
<div class="mb-8">
    <a href="{{ url_for('index') }}" class="inline-flex items-center text-blue-600 hover:text-blue-800">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        返回上传页面
    </a>
</div>

<div class="bg-white rounded-xl shadow-lg p-8 mb-10">
    <h2 class="text-2xl font-bold mb-6 text-center">相似图片搜索结果</h2>
    
    <div class="mb-8">
        <h3 class="text-lg font-medium mb-3">您的查询图片:</h3>
        <div class="max-w-md mx-auto">
            <img src="{{ url_for('static', filename=query_image.replace('static/', '')) }}" alt="查询图片" class="w-full h-auto rounded-lg shadow-md">
        </div>
    </div>
    
    <div>
        <h3 class="text-lg font-medium mb-4">找到的相似图片:</h3>
        
        {% if similar_images|length > 0 %}
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                {% for img in similar_images %}
                    <div class="image-card bg-gray-50 rounded-lg overflow-hidden shadow-md">
                        <div class="relative">
                            <img src="{{ url_for('static', filename=img.path.replace('static/', '')) }}" alt="相似图片" class="w-full h-48 object-cover">
                            <div class="similarity-badge 
                                {% if img.similarity > 90 %}similarity-high
                                {% elif img.similarity > 70 %}similarity-medium
                                {% elif img.similarity > 50 %}similarity-low
                                {% else %}similarity-very-low{% endif %}">
                                {{ "%.1f"|format(img.similarity) }}%
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="font-medium text-gray-800 truncate mb-1">{{ img.filename }}</h4>
                            <p class="text-gray-500 text-sm mb-3">相似度: {{ "%.1f"|format(img.similarity) }}%</p>
                            <a href="{{ url_for('static', filename=img.path.replace('static/', '')) }}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                                查看原图
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-12 bg-gray-50 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h4 class="text-xl font-medium text-gray-700 mb-2">未找到相似图片</h4>
                <p class="text-gray-500">我们的数据库中没有与您上传的图片相似的图像</p>
            </div>
        {% endif %}
    </div>
</div>

<div class="bg-blue-50 rounded-lg p-8 border border-blue-200">
    <h3 class="text-xl font-bold mb-4 text-blue-800">相似度解释</h3>
    <div class="space-y-3">
        <div class="flex items-start">
            <div class="w-12 h-6 bg-green-500 rounded mr-3 flex-shrink-0"></div>
            <p class="text-gray-700"><span class="font-medium">90% 以上</span> - 几乎相同的图片，可能只有微小的变化或编辑</p>
        </div>
        <div class="flex items-start">
            <div class="w-12 h-6 bg-blue-500 rounded mr-3 flex-shrink-0"></div>
            <p class="text-gray-700"><span class="font-medium">70% - 90%</span> - 高度相似的图片，可能是相同主题的不同角度或编辑版本</p>
        </div>
        <div class="flex items-start">
            <div class="w-12 h-6 bg-yellow-500 rounded mr-3 flex-shrink-0"></div>
            <p class="text-gray-700"><span class="font-medium">50% - 70%</span> - 中等相似度，可能存在一些共同元素或颜色模式</p>
        </div>
        <div class="flex items-start">
            <div class="w-12 h-6 bg-red-500 rounded mr-3 flex-shrink-0"></div>
            <p class="text-gray-700"><span class="font-medium">50% 以下</span> - 相似度较低，可能只有少量共同特征</p>
        </div>
    </div>
</div>
{% endblock %}
